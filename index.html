<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="./favcon.png" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loop_Room</title>
    <link rel="stylesheet" href="style.css" />
    <meta
      name="description"
      content="Minimalist looping video with drifting chat bubbles and glitch."
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="data:," />
  </head>

  <body>
    <video id="bg-video" autoplay loop playsinline muted>
      <source id="bg-source" src="videos/tango.mp4" type="video/mp4" />
    </video>

    <div id="glitch-layer"></div>
    <div id="bubble-layer"></div>

    <!-- Top-left banners -->
    <div id="banner-wrap" aria-hidden="true">
      <div id="title-banner">LOOP ROOM</div>
      <div id="click-banner">CLICK!</div>
    </div>

    <!-- Global Click Counter -->
    <div id="counter">
      <div id="click-count">0</div>
      <div id="caption">nothing counts but we count clicks</div>
    </div>

    <!-- Signature -->
    <div id="signature">
      by
      <a
        href="https://sergiob79.github.io/Noctarion_page/#"
        target="_blank"
        rel="noopener noreferrer"
        >Noctarion</a
      >
    </div>

    <!-- Footer trigger: disclaimer -->
    <div
      id="disclaimer-link"
      role="button"
      aria-controls="disclaimer-bubble"
      aria-expanded="false"
    >
      disclaimer
    </div>

    <script src="messages.js"></script>
    <script src="script.js"></script>

    <!-- Firebase live counter (configured) -->
    <script type="module">
      import {
        initializeApp
      } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
      import {
        getAnalytics
      } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-analytics.js";
      import {
        getDatabase,
        ref,
        onValue,
        runTransaction
      } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-database.js";

      // âœ… Your Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDNfJF7pHKeXaQ3dKBYZvDYfk2mvmXCtuk",
        authDomain: "looproomcounter.firebaseapp.com",
        databaseURL: "https://looproomcounter-default-rtdb.firebaseio.com",
        projectId: "looproomcounter",
        storageBucket: "looproomcounter.firebasestorage.app",
        messagingSenderId: "127016928679",
        appId: "1:127016928679:web:e0284e8957c25f94e96282",
        measurementId: "G-43CMFG4RZN"
      };

      try {
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // Optional: initialize analytics
        try {
          getAnalytics(app);
        } catch (err) {
          console.warn("Analytics not available:", err);
        }

        // Realtime Database counter logic
        const db = getDatabase(app);
        const clicksRef = ref(db, "clicks");
        const countEl = document.getElementById("click-count");

        // Listen for counter updates
        onValue(clicksRef, (snap) => {
          const val = snap.val() || 0;
          countEl.textContent = val;
          countEl.classList.add("flicker");
          setTimeout(() => countEl.classList.remove("flicker"), 200);
        });

        // Increment on click
        document.addEventListener("click", () => {
          runTransaction(clicksRef, (n) => (n || 0) + 1);
        });
      } catch (e) {
        console.warn("Counter disabled (Firebase init failed):", e);
      }
    </script>
  </body>
</html>
